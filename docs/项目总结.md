# 基于产生式知识表示的专家系统

## 项目概述

本项目是一个基于产生式规则（Production Rules）的专家系统，采用 C++ 核心推理引擎 + Python GUI + Vue3 Web 前端的混合架构。系统支持正向推理和反向推理，并提供推理过程可视化功能。

## 技术架构

### 1. 核心推理引擎 (C++)

- **Rule_reasoner**: 使用 C++ 实现的高性能推理引擎
- **nanobind**: C++ 与 Python 的绑定库，将推理引擎暴露给 Python 调用
- **CMake**: 构建系统

推理引擎实现了：
- 产生式规则的存储和管理
- 正向推理（Forward Chaining）：从已知事实推导结论
- 反向推理（Backward Chaining）：从目标结论反向验证
- 冲突消解策略

### 2. 桌面 GUI (PyQt6)

文件：`expert_system_gui.py`

- **PyQt6**: 跨平台桌面 GUI 框架
- 功能标签页：
  - 知识库规则管理
  - 推理系统（事实选择、正向/反向推理）
  - 推理过程可视化（基于 vis.js）
  - Web 服务器控制

### 3. Web 后端 (Flask)

文件：`web_server.py`

- **Flask**: 轻量级 Web 框架
- **flask-cors**: 跨域资源共享支持
- REST API 接口：
  - `/api/auth/*` - 用户认证（登录、注册、登出）
  - `/api/rules/*` - 规则管理
  - `/api/facts/*` - 事实管理
  - `/api/inference/*` - 推理操作
  - `/api/history/*` - 历史记录
  - `/api/admin/*` - 管理员功能

### 4. Web 前端 (Vue3)

目录：`web_frontend/`

- **Vue 3**: 前端框架（Composition API）
- **Vite**: 构建工具
- **Element Plus**: UI 组件库（暗色主题）
- **Pinia**: 状态管理
- **Vue Router**: 路由管理
- **vis-network**: 图形可视化库
- **Axios**: HTTP 客户端

页面结构：
```
├── LoginView.vue      # 登录/注册页
├── LayoutView.vue     # 主布局（侧边栏、顶栏）
├── HomeView.vue       # 首页（统计、介绍）
├── InferenceView.vue  # 推理系统（核心功能）
├── HistoryView.vue    # 历史记录管理
└── AdminView.vue      # 管理员面板（规则、用户管理）
```

## 主要功能

### 1. 知识库管理
- 规则的增删改查
- 批量导入规则
- 重置为默认规则库
- 规则格式：`前提1 + 前提2 + ... → 结论`

### 2. 推理功能

#### 正向推理（Forward Chaining）
从用户选择的已知事实出发，逐步应用匹配的规则，推导出所有可能的结论。

#### 反向推理（Backward Chaining）
从目标结论出发，反向查找需要满足的条件。当遇到未知事实时，系统会询问用户该事实是否为真。

### 3. 推理可视化
- 使用 vis-network 绘制推理路径图
- 节点表示事实和结论
- 边表示规则应用
- 支持逐步演示推理过程
- 滑块控制当前显示步骤

### 4. 用户系统
- 用户注册/登录
- 角色区分（普通用户 / 管理员）
- Token 认证机制
- 会话管理

### 5. 历史记录
- 保存每次推理结果
- 查看详细推理过程
- 支持删除和清空历史

## 部署方式

### 开发模式

```bash
# 1. 安装 Python 依赖
pip install PyQt6 PyQt6-WebEngine flask flask-cors

# 2. 构建 C++ 推理引擎
mkdir build && cd build
cmake ..
make

# 3. 构建前端
cd web_frontend
pnpm install
pnpm build

# 4. 运行
python expert_system_gui.py
```

### 打包为 EXE

```bash
# 确保前端已构建
cd web_frontend && pnpm build && cd ..

# 使用 PyInstaller 打包
pyinstaller --noconsole --onefile --name ExpertSystem \
  --add-data "web_frontend/dist;web_frontend/dist" \
  expert_system_gui.py
```

### 命令行参数

```bash
# 启动完整 GUI
ExpertSystem.exe

# 仅启动 Web 服务器（无 GUI）
ExpertSystem.exe --web --port 5000 --host 0.0.0.0
```

## 文件结构

```
last-work/
├── CMakeLists.txt              # CMake 构建配置
├── expert_system_gui.py        # 主程序（GUI + Web 集成）
├── web_server.py               # Flask Web 服务器
├── rules.json                  # 规则库存储
├── users.json                  # 用户数据存储
├── inference_history.json      # 推理历史存储
├── build_exe.py                # 打包脚本
├── Rule_reasoner.pyi           # C++ 模块类型提示
├── cpp_py/                     # C++ 源码
│   ├── bcpp/
│   │   └── Rule_reasoner.bcpy.cpp
│   └── cpp/
│       └── Rule_reasoner.cpy.cpp
├── build/                      # CMake 构建目录
├── web_frontend/               # Vue3 前端项目
│   ├── package.json
│   ├── vite.config.js
│   ├── src/
│   │   ├── main.js
│   │   ├── App.vue
│   │   ├── api/
│   │   │   └── index.js        # API 封装
│   │   ├── router/
│   │   │   └── index.js        # 路由配置
│   │   ├── stores/
│   │   │   └── user.js         # Pinia 状态管理
│   │   └── views/
│   │       ├── LoginView.vue
│   │       ├── LayoutView.vue
│   │       ├── HomeView.vue
│   │       ├── InferenceView.vue
│   │       ├── HistoryView.vue
│   │       └── AdminView.vue
│   └── dist/                   # 构建输出
└── docs/
    └── 项目总结.md
```

## 默认规则库（动物识别专家系统）

系统内置了一个动物识别规则库作为示例：

```
毛发 → 哺乳动物
有奶 → 哺乳动物
羽毛 → 鸟
会飞 + 下蛋 → 鸟
吃肉 → 肉食动物
犬齿 + 有爪 + 眼盯前方 → 肉食动物
哺乳动物 + 有蹄 → 蹄类动物
哺乳动物 + 反刍动物 → 蹄类动物
哺乳动物 + 肉食动物 + 黄褐色 + 暗斑点 → 金钱豹
哺乳动物 + 肉食动物 + 黄褐色 + 黑色条纹 → 老虎
蹄类动物 + 长脖子 + 长腿 + 暗斑点 → 长颈鹿
蹄类动物 + 黑色条纹 → 斑马
鸟 + 长脖子 + 长腿 + 黑白两色 + 不飞 → 鸵鸟
鸟 + 会游泳 + 黑白两色 + 不飞 → 企鹅
鸟 + 善飞 → 信天翁
...
```

## 特色功能

1. **双推理引擎**：支持正向和反向两种推理模式
2. **可视化展示**：直观展示推理路径和过程
3. **双端支持**：桌面 GUI 和 Web 界面并存
4. **权限管理**：区分管理员和普通用户
5. **历史追溯**：完整记录每次推理过程
6. **暗色主题**：使用 Element Plus 官方暗色模式
7. **单文件打包**：可打包为独立 EXE 运行

## 技术亮点

1. **C++/Python 混合架构**：核心算法用 C++ 实现保证性能，界面用 Python/Vue 实现便于开发
2. **nanobind 绑定**：相比 pybind11 更轻量高效
3. **Flask 静态文件服务**：前端打包后由 Flask 统一托管
4. **PyInstaller 打包**：使用 `sys._MEIPASS` 正确处理打包后的资源路径
5. **Token 认证**：基于内存 Session 的简易认证系统
6. **响应式设计**：Element Plus 组件自适应不同屏幕

## 后续改进方向

1. 持久化 Session 存储（如 Redis）
2. 规则导入导出功能
3. 更复杂的冲突消解策略
4. 规则权重和置信度支持
5. 多语言支持
